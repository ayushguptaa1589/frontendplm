<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PLM Designer Dashboard - Create and manage parts, assemblies, and designs">
    <meta name="theme-color" content="#007bff">
    <title>PLM - Designer Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="logo-text">PLM</h1>
                <p class="role-badge designer">Designer</p>
            </div>
            
            <nav class="sidebar-menu">
                <a href="#" class="menu-item active" data-menu="projects">
                    <span class="icon">üìê</span>
                    <span>My Projects</span>
                </a>
                <a href="#" class="menu-item" data-menu="designs">
                    <span class="icon">üé®</span>
                    <span>My Designs</span>
                </a>
                <a href="#" class="menu-item" data-menu="tasks">
                    <span class="icon">‚úì</span>
                    <span>Tasks</span>
                </a>
                <a href="#" class="menu-item" data-menu="submissions">
                    <span class="icon">üì§</span>
                    <span>Submissions</span>
                </a>
                <a href="#" class="menu-item" data-menu="vault">
                    <span class="icon">üóÇÔ∏è</span>
                    <span>Vault</span>
                </a>
                <a href="#" class="menu-item" data-menu="profile">
                    <span class="icon">üë§</span>
                    <span>Profile</span>
                </a>
                <a href="#" class="menu-item" data-menu="settings">
                    <span class="icon">‚öôÔ∏è</span>
                    <span>Settings</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <h2 id="page-title">My Projects</h2>
                <div class="top-bar-actions">
                    <div class="global-search-container">
                        <input type="text" id="globalSearchInput" class="global-search-input" placeholder="Search parts, assemblies, projects...">
                        <div id="searchResultsDropdown" class="search-results-dropdown"></div>
                    </div>
                    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">‚òÄÔ∏è</button>
                    <div class="notification-bell" onclick="toggleNotificationDropdown()">
                        üîî<span id="notifBadge" class="notif-badge" style="display:none;">0</span>
                        <div id="notificationDropdown" class="notification-dropdown">
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                                <strong>Notifications</strong>
                                <button onclick="markAllRead()" style="background:none;border:none;color:var(--accent);cursor:pointer;font-size:12px;">Mark all read</button>
                            </div>
                            <div id="notification-list"></div>
                        </div>
                    </div>
                    <span id="username" class="username">Designer User</span>
                </div>
            </header>

            <div class="hierarchy-flow" id="hierarchyFlow">
                <div class="flow-step" data-role="designer">Designer</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step" data-role="approver">Approver</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step" data-role="admin">Admin</div>
            </div>

            <!-- Projects Section -->
            <section class="content-section" id="projects-section">
                <div class="section-header">
                    <h3>Assigned Projects</h3>
                </div>

                <div class="filters">
                    <input type="text" id="searchInput" placeholder="Search projects..." class="filter-input">
                    <select id="statusFilter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="assigned">Assigned</option>
                        <option value="inprogress">In Progress</option>
                        <option value="review">Under Review</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>

                <div class="project-grid" id="projectsGrid">
                    <p style="text-align: center; color: #999; padding: 40px;">Loading projects...</p>
                </div>
            </section>

            <!-- Tasks Section -->
            <section class="content-section" id="tasks-section" style="display: none;">
                <div class="section-header">
                    <h3>My Tasks</h3>
                </div>

                <div class="tasks-list">
                    <div class="task-item">
                        <div class="task-checkbox">
                            <input type="checkbox">
                        </div>
                        <div class="task-content">
                            <h4>Complete UI Design</h4>
                            <p>Design the user interface for Project PLM-PRI-003</p>
                            <span class="task-date">Due: 2026-02-15</span>
                        </div>
                        <div class="task-priority high">High</div>
                    </div>

                    <div class="task-item">
                        <div class="task-checkbox">
                            <input type="checkbox">
                        </div>
                        <div class="task-content">
                            <h4>Code Review</h4>
                            <p>Review code changes for approval</p>
                            <span class="task-date">Due: 2026-02-18</span>
                        </div>
                        <div class="task-priority medium">Medium</div>
                    </div>
                </div>
            </section>

            <!-- Designs Section -->
            <section class="content-section" id="designs-section" style="display: none;">
                <div class="section-header">
                    <h3>My Designs</h3>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openCreateDesignModal()">+ Create Design</button>
                        <button class="btn btn-primary" onclick="openSubmitDesignModal()">üì§ Submit Design</button>
                    </div>
                </div>

                <div class="filters">
                    <input type="text" id="designSearchInput" placeholder="Search designs..." class="filter-input">
                    <select id="designStatusFilter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="draft">Draft</option>
                        <option value="inprogress">In Progress</option>
                        <option value="submitted">Submitted</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Design Name</th>
                                <th>Project</th>
                                <th>Status</th>
                                <th>Priority</th>
                                <th>Created</th>
                                <th>Last Modified</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="designsTable">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 20px;">Loading designs...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
                <div class="section-header">
                    <h3>My Submissions</h3>
                    <button class="btn btn-primary" onclick="openSubmitModal()">+ New Submission</button>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Submission Date</th>
                                <th>Project</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Reviewer</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="submissionsTable">
                            <tr>
                                <td>2026-02-05</td>
                                <td>Dashboard Project</td>
                                <td>Design Mockup</td>
                                <td><span class="status-badge review">Under Review</span></td>
                                <td>PRAVAIG-15</td>
                                <td class="actions">
                                    <button class="btn-icon" onclick="viewSubmission(1)">üëÅÔ∏è</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Profile Section -->
            <section class="content-section" id="profile-section" style="display: none;">
                <div class="section-header">
                    <h3>My Profile</h3>
                </div>

                <div class="profile-form">
                    <div class="form-group">
                        <label>User ID</label>
                        <input type="text" id="profileUserId" value="" disabled class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="profileFullName" value="" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="profileEmail" value="" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Specialization</label>
                        <input type="text" id="profileSpecialization" value="" class="form-input">
                    </div>
                    <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="content-section" id="settings-section" style="display: none;">
                <div class="section-header">
                    <h3>Settings</h3>
                </div>

                <!-- Change Password Form -->
                <div class="settings-form">
                    <h4>Change Password</h4>
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <div class="password-toggle-container">
                            <input type="password" id="currentPassword" class="password-field" placeholder="Enter your current password" required>
                            <button type="button" class="password-toggle-btn" data-target="currentPassword" aria-label="Toggle password visibility">
                                <span class="toggle-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <div class="password-toggle-container">
                            <input type="password" id="newPassword" class="password-field" placeholder="Enter new password" required>
                            <button type="button" class="password-toggle-btn" data-target="newPassword" aria-label="Toggle password visibility">
                                <span class="toggle-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm New Password</label>
                        <div class="password-toggle-container">
                            <input type="password" id="confirmPassword" class="password-field" placeholder="Confirm new password" required>
                            <button type="button" class="password-toggle-btn" data-target="confirmPassword" aria-label="Toggle password visibility">
                                <span class="toggle-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    <div id="passwordError" class="error-message" style="display:none;"></div>
                    <div id="passwordSuccess" class="success-message" style="display:none;"></div>
                    <button class="btn btn-primary" onclick="handleChangePassword()">Change Password</button>
                </div>
            </section>

            <!-- Vault Section -->
            <section class="content-section" id="vault-section" style="display: none;">
                <div class="section-header">
                    <h3>Parts</h3>
                </div>

                <div class="filters">
                    <input type="text" id="designerPartSearch" placeholder="Search parts..." class="filter-input" oninput="filterDesignerParts()">
                    <select id="designerPartCriticality" class="filter-select" onchange="filterDesignerParts()">
                        <option value="">All Criticality</option>
                        <option value="low">Low</option>
                        <option value="normal">Normal</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Part Code</th>
                                <th>Name</th>
                                <th>Material</th>
                                <th>Criticality</th>
                                <th>Owner</th>
                                <th>Versions</th>
                                <th>Latest</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="designerPartsTable">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 20px;">Loading parts...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="section-header" style="margin-top: 30px;">
                    <h3>Assemblies</h3>
                </div>

                <div class="filters">
                    <input type="text" id="designerAssemblySearch" placeholder="Search assemblies..." class="filter-input" oninput="filterDesignerAssemblies()">
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Assembly Code</th>
                                <th>Name</th>
                                <th>Criticality</th>
                                <th>Owner</th>
                                <th>Versions</th>
                                <th>Latest</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="designerAssembliesTable">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 20px;">Loading assemblies...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Designer Part Versions Modal -->
    <div id="designerPartVersionsModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeModal('designerPartVersionsModal')">&times;</span>
            <h2>Part Versions</h2>
            <div class="section-header" style="margin-top: 10px;">
                <h3 id="designerPartVersionsTitle">Part</h3>
                <button class="btn btn-secondary" onclick="showDesignerPartImpact()">üîó Impact</button>
            </div>
            <div id="designerPartMetadataBar" style="margin-bottom:10px;padding:10px;background:rgba(255,255,255,0.05);border-radius:8px;font-size:0.9em;"></div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Version</th>
                            <th>Status</th>
                            <th>Change Notes</th>
                            <th>Frozen By</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="designerPartVersionsTable">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 20px;">Loading versions...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Designer Assembly Versions Modal -->
    <div id="designerAssemblyVersionsModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeModal('designerAssemblyVersionsModal')">&times;</span>
            <h2>Assembly Versions</h2>
            <div class="section-header" style="margin-top: 10px;">
                <h3 id="designerAssemblyVersionsTitle">Assembly</h3>
            </div>
            <div id="designerAssemblyMetadataBar" style="margin-bottom:10px;padding:10px;background:rgba(255,255,255,0.05);border-radius:8px;font-size:0.9em;"></div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Version</th>
                            <th>Status</th>
                            <th>Frozen By</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="designerAssemblyVersionsTable">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 20px;">Loading versions...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Impact Modal (Designer) -->
    <div id="designerImpactModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeModal('designerImpactModal')">&times;</span>
            <h2>üîó Dependency Impact</h2>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Assembly Code</th>
                            <th>Assembly Name</th>
                            <th>Assembly Version</th>
                            <th>Status</th>
                            <th>Part Version Used</th>
                        </tr>
                    </thead>
                    <tbody id="designerImpactTable">
                        <tr><td colspan="5" style="text-align:center;padding:20px;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- BOM Modal (Designer) -->
    <div id="designerBomModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeModal('designerBomModal')">&times;</span>
            <h2>üìã Bill of Materials</h2>
            <h3 id="designerBomTitle" style="color:#aaa;"></h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Part Code</th>
                            <th>Part Name</th>
                            <th>Version</th>
                            <th>Status</th>
                            <th>Material</th>
                            <th>Vendor</th>
                            <th>Criticality</th>
                        </tr>
                    </thead>
                    <tbody id="designerBomTable">
                        <tr><td colspan="7" style="text-align:center;padding:20px;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Request Edit Access Modal -->
    <div id="requestEditModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('requestEditModal')">&times;</span>
            <h2>Request Edit Access</h2>
            <form>
                <div class="form-group">
                    <label>Reason</label>
                    <textarea id="editRequestReason" class="form-input" rows="3"></textarea>
                </div>
                <button type="button" class="btn btn-primary" onclick="submitEditRequest()">Submit Request</button>
            </form>
        </div>
    </div>

    <!-- Request Release Modal -->
    <div id="requestReleaseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('requestReleaseModal')">&times;</span>
            <h2>Request Release</h2>
            <form>
                <div class="form-group">
                    <label>Reason</label>
                    <textarea id="releaseRequestReason" class="form-input" rows="3"></textarea>
                </div>
                <button type="button" class="btn btn-primary" onclick="submitReleaseRequest()">Submit Request</button>
            </form>
        </div>
    </div>

    <!-- Submission Modal -->
    <div id="submitModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('submitModal')">&times;</span>
            <h2>Submit Work</h2>
            <form>
                <div class="form-group">
                    <label>Project</label>
                    <select required>
                        <option>Select Project</option>
                        <option>Dashboard Project</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Submission Type</label>
                    <select required>
                        <option>Design Mockup</option>
                        <option>Code</option>
                        <option>Documentation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>File</label>
                    <input type="file" required>
                </div>
                <div class="form-group">
                    <label>Comments</label>
                    <textarea placeholder="Add any comments..." rows="4"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" onclick="submitWork(event)">Submit</button>
            </form>
        </div>
    </div>

    <!-- Design Management Modals -->
    
    <!-- Create Design Modal -->
    <div id="createDesignModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('createDesignModal')">&times;</span>
            <h2>Create New Design</h2>
            <form>
                <div class="form-group">
                    <label>Design Name *</label>
                    <input type="text" id="designName" placeholder="Enter design name" required class="form-input">
                </div>
                <div class="form-group">
                    <label>Project *</label>
                    <select id="designProject" required class="form-input">
                        <option value="">Select Project</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="designDescription" placeholder="Design description..." rows="3" class="form-input"></textarea>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="designPriority" class="form-input">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <button type="button" class="btn btn-primary" onclick="createDesign(event)">Create Design</button>
            </form>
        </div>
    </div>

    <!-- Submit Design Modal -->
    <div id="submitDesignModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('submitDesignModal')">&times;</span>
            <h2>Submit Design for Review</h2>
            <form>
                <div class="form-group">
                    <label>Design *</label>
                    <select id="submitDesignSelect" required class="form-input">
                        <option value="">Select Design</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Submission Type *</label>
                    <select id="submissionType" required class="form-input">
                        <option value="">Select Type</option>
                        <option value="draft">Draft</option>
                        <option value="mockup">Mockup</option>
                        <option value="final">Final Submission</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Comments</label>
                    <textarea id="submissionComments" placeholder="Add submission comments..." rows="4" class="form-input"></textarea>
                </div>
                <button type="button" class="btn btn-primary" onclick="submitDesign(event)">Submit for Review</button>
            </form>
        </div>
    </div>

    <!-- Design Details Modal -->
    <div id="designDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('designDetailsModal')">&times;</span>
            <h2 id="detailsModalTitle">Design Details</h2>
            <div id="designDetailsContent" class="details-container">
                <!-- Dynamically populated -->
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-primary" onclick="openDesignSubmitFlow()">Submit for Review</button>
                <button type="button" class="btn btn-danger" id="deleteDesignBtn" onclick="deleteCurrentDesign()">Delete Design</button>
                <button type="button" class="btn" onclick="closeModal('designDetailsModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Update Progress Modal -->
    <div id="updateProgressModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('updateProgressModal')">&times;</span>
            <h2>Update Project Progress</h2>
            <div id="progressProjectInfo" style="margin-bottom: 15px; padding: 12px; background: rgba(0,123,255,0.1); border-radius: 8px;"></div>
            <form>
                <div class="form-group">
                    <label>Progress (0-100%)</label>
                    <input type="range" id="progressSlider" min="0" max="100" value="0" oninput="document.getElementById('progressValue').textContent = this.value + '%'" style="width: 100%;">
                    <p style="text-align: center; font-size: 24px; font-weight: 700; color: var(--primary-color);" id="progressValue">0%</p>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="progressStatus" class="form-input">
                        <option value="active">Active</option>
                        <option value="inprogress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <button type="button" class="btn btn-primary" onclick="saveProgress()">Save Progress</button>
            </form>
        </div>
    </div>

    <script src="api.js"></script>
    <script src="designer-dashboard.js"></script>
</body>
</html>
